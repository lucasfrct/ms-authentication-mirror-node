class AuthenticationMirrorClient{rsa=null;crypt=null;client={protocol:"",host:"",uri:"",url:""};keysBox={origin:{public:"",private:"",secret:"",signature:""},destiny:{public:"",signature:""}};formBox={origin:{reform:"",deform:"",raw:""},destiny:{reform:"",deform:"",raw:""}};reflex={origin:{public:"",cipher:"",body:{}},destiny:{public:"",cipher:"",body:{}}};constructor(){this.rsa=new RSA({keySize:4096}),this.crypt=new Crypt({md:"sha512"})}url(r=""){return this.client.uri=r||this.client.uri,this.client.protocol=window.location.protocol,this.client.host=window.location.host,this.client.url=this.client.protocol+"://"+this.client.host+this.client.uri,this.client.url}raw(r=""){return this.formBox.origin.raw=r||this.formBox.origin.raw}setReflex(r={}){return this.reflex={...this.reflex,...r}}match(e={}){if(!e.hasOwnProperty("origin")||e.origin.hasOwnProperty("cipher"))return e.hasOwnProperty("origin")&&e.origin.hasOwnProperty("cipher")?({origin:{public:i,cipher:o},destiny:{public:s,cipher:n}}=e,this.keysBox.origin={...this.keysBox.origin,public:i},this.keysBox.destiny={...this.keysBox.destiny,public:s},this.formBox.origin={...this.formBox.origin,deform:o},this.formBox.destiny={...this.formBox.destiny,deform:n},this.reflex):this.reflex={...this.reflex,...e};{let r=this.keysBox,t=this.formBox;e.origin.hasOwnProperty("private")&&(r=e);var{origin:{deform:i},destiny:{deform:s}}=t=e.origin.hasOwnProperty("reform")?e:t,{origin:{public:o},destiny:{public:n}}=r;return this.reflex.origin={...this.reflex.origin,cipher:i,public:o},this.reflex.destiny={...this.reflex.destiny,cipher:s,public:n},this.reflex}}async captureKeys(){try{var{publicKey:r,privateKey:t}=await this.rsa.generateKeyPairAsync(),e=this.parse(this.crypt.encrypt(r,"De@14@Jxfjm^MiKpQP6tzKSm83xpa*vfXRi2bSjvtSFGVbwU8Yy&9K*&soIT5ft&EIS"))["iv"],i=this.parse(await this.crypt.signature(t,e))["signature"];return this.keysBox.origin={public:r,private:t,secret:e,signature:i},this.keysBox}catch(r){return console.error(r),this.keysBox}}async writeKeys(r=""){return localStorage.setItem(r+"AuthenticateMirrorPublicKey",this.keysBox.origin.public),localStorage.setItem(r+"AuthenticateMirrorPrivateKey",this.keysBox.origin.private),localStorage.setItem(r+"AuthenticateMirrorSecretKey",this.keysBox.origin.secret),localStorage.setItem(r+"AuthenticateMirrorSignature",this.keysBox.origin.signature),this.keysBox}async readKeys(r=""){return this.keysBox.public=await localStorage.getItem(r+"AuthenticateMirrorPublicKey")||"",this.keysBox.private=await localStorage.getItem(r+"AuthenticateMirrorPrivateKey")||"",this.keysBox.secret=await localStorage.getItem(r+"AuthenticateMirrorSecretKey")||"",this.keysBox.signature=await localStorage.getItem(r+"AuthenticateMirrorSignature")||"",this.keysBox}async loadKeys(){return this.keysBox.origin.public.length<64&&await this.readKeys(),this.keysBox.origin.public.length<64&&(await this.captureKeys(),await this.writeKeys()),this.keysBox}async signature(r=""){try{if(this.keysBox.origin.private.length<64)return console.error("Erro, a chave privada não existe"),this.keysBox.origin.signature;var t=this.parseStr(this.raw(r)),e=this.parse(this.crypt.signature(this.keysBox.origin.private,t))["signature"];return this.keysBox.origin.signature=e}catch(r){return console.error("Nõ foi possível asinnar o dado: ",r),this.keysBox.origin.signature}}async verify(r=""){return this.crypt.verify(this.keysBox.origin.public,this.raw(r),this.keysBox.origin.signature)}async deform(r=""){try{var t=this.keysBox.destiny.public;if(t.length<64)return console.error("Erro, a chave publica não existe"),this.formBox.origin.deform;var e=this.parseStr(this.raw(r)),i=await this.signature(e);return this.formBox.origin.deform=this.crypt.encrypt(t,e,i)}catch(r){return console.error("Error ao deforma um dado: ",r),this.formBox.origin.deform}}async reform(r=""){try{this.formBox.destiny.deform=r||this.formBox.destiny.deform;var t=this.keysBox.origin.private;if(t.length<64)return console.error("Erro, a chave privada não existe"),this.formBox.destiny.reform;var{message:e,signature:i}=this.crypt.decrypt(t,this.formBox.destiny.deform);return this.keysBox.destiny.signature=i,this.formBox.destiny.reform=this.parse(e)}catch(r){return console.error("Error ao tentar decifrar o dado"),this.formBox.destiny.reform}}config(r="GET",t=void 0){const e=new Headers;return e.append("Content-Type","application/json"),e.append("Accept-Charset","utf-8"),{mode:"cors",headers:e,method:r,body:t}}async send(r=""){try{var t=this.url(),e=this.config("POST",this.parseStr(this.setReflex(r))),i=new Request(t,e);const o=await fetch(i);var s=await o.json();return await this.setReflex(s)}catch(r){return console.error("Error ao tentar acessar o servidor: ",r),this.setReflex()}}async get(){try{var r=this.url(),t=this.config("GET"),e=new Request(r,t);const s=await fetch(e);var i=await s.json();return await this.setReflex(i)}catch(r){return console.error("Error ao tentar acessar o servidor: ",r),this.setReflex()}}async reflect(r={}){return this.url("/authentication/mirror/reflect"),await this.loadKeys(),this.setReflex(r),this.match(this.keysBox),await this.send(),this.reflex}async distort(r={}){return this.url("/authentication/mirror/distort"),this.setReflex(r),this.send()}parse(t=""){try{return JSON.parse(t)}catch(r){return t}}parseStr(t=void 0){try{return"string"==typeof t?t:JSON.stringify(t)}catch(r){return console.error(r),String(t)}}}
class AuthenticationClientMirror{rsa=null;crypt=null;headers=["x-api-token","Bearer","authorization"];client={protocol:"",host:"",uri:"",url:""};keysBox={public:"",private:"",secret:"",signature:"",image:"",destiny:""};formBox={raw:"",reform:{origin:"",image:"",destiny:""},deform:{origin:"",image:"",destiny:""}};reflex={origin:{public:"",cipher:"",raw:""},image:{public:"",cipher:"",raw:""},destiny:{public:"",cipher:"",raw:""},body:""};params={type:"GET",contentType:"application/json; charset=utf-8"};constructor(){this.rsa=new RSA({keySize:4096}),this.crypt=new Crypt({md:"sha512"})}setRaw(e=""){return this.formBox.raw=e||this.formBox.raw}setReflex(e=null){return this.reflex=e||this.reflex}setPublic(e=""){return this.reflex.origin.public=e||this.reflex.origin.public,this.keysBox.public=e||this.keysBox.public}setImage(e=""){return this.reflex.image.public=e||this.reflex.image.public,this.keysBox.image=e||this.keysBox.image}setDestinity(e=""){return this.reflex.destiny.public=e||this.reflex.destiny.public,this.keysBox.destiny=e||this.keysBox.destiny}setDeformImage(e=""){return this.reflex.image.cipher=e||this.reflex.image.cipher,this.formBox.deform.image=e||this.formBox.deform.image}setDeformOrigin(e=""){return this.reflex.origin.cipher=e||this.reflex.origin.cipher,this.formBox.deform.origin=e||this.formBox.deform.origin}setReformImage(e=""){return this.reflex.image.raw=e||this.reflex.image.raw,this.formBox.reform.image=e||this.formBox.reform.image}setUrl(e=""){return this.client.uri=e||this.client.uri,this.client.protocol=window.location.protocol,this.client.host=window.location.host,this.client.url=this.client.protocol+"//"+this.client.host+this.client.uri,this.client.url}async captureKeys(){try{var{publicKey:e,privateKey:t}=await this.rsa.generateKeyPairAsync(),r=this.parse(this.crypt.encrypt(e,"De@14@Jxfjm^MiKpQP6tzKSm83xpa*vfXRi2bSjvtSFGVbwU8Yy&9K*&soIT5ft&EIS"))["iv"],i=await this.crypt.signature(this.keysBox.private,r);return this.keysBox={...this.keysBox,public:e,private:t,secret:i}}catch(e){return console.error("Não foi possível gerar o par de chaves: ",e),this.keysBox}}async writeKeys(){return localStorage.setItem("AuthenticateMirrorPublicKey",this.keysBox.public),localStorage.setItem("AuthenticateMirrorPrivateKey",this.keysBox.private),localStorage.setItem("AuthenticateMirrorSecretKey",this.keysBox.secret),this.keysBox}async readKeys(){return this.keysBox.public=localStorage.getItem("AuthenticateMirrorPublicKey")||"",this.keysBox.private=localStorage.getItem("AuthenticateMirrorPrivateKey")||"",this.keysBox.secret=localStorage.getItem("AuthenticateMirrorSecretKey")||"",this.keysBox}async loadKeys(){this.keysBox.public.length<64&&await this.readKeys(),this.keysBox.public.length<64&&(await this.captureKeys(),await this.writeKeys()),this.keysBox}async signature(e=""){try{if(this.keysBox.private.length<64)return this.keysBox.signature;var t=this.parseStr(this.setRaw(e)),r=this.parse(this.crypt.signature(this.keysBox.private,t))["signature"];return this.keysBox.signature=r}catch(e){return console.error(e),this.keysBox.signature}}async verify(e=""){return this.crypt.verify(this.keysBox.public,this.setRaw(e),this.keysBox.signature)}async deform(e=""){try{var t=this.setImage();if(t.length<64)return console.error("Erro, a chave publica não existe"),this.setDeformOrigin();var r=this.parseStr(this.setRaw(e)),i=this.signature(r);return this.setDeformOrigin(this.crypt.encrypt(t,r,i))}catch(e){return console.error("Error ao deforma um dado: ",e),this.setDeformOrigin()}}async reform(e=""){try{var t=this.keysBox.private;if(t.length<64)return console.error("Erro, a chave privada não existe"),this.setReformImage();var{message:r,signature:i}=this.crypt.decrypt(t,this.setDeformImage(e));return this.keysBox.signature=i,this.keysBox.signature&&!this.verify(r)?(console.error("Erro, documento com assinatura inválida"),this.setReformImage()):this.setReformImage(this.parse(r))}catch(e){return console.error("Error ao tentar decifra a=o dado"),this.setReformImage()}}async send(e=""){try{return this.params.data=this.parseStr(this.setReflex(e)),this.params.type="POST",this.params.url=this.setUrl(),this.setReflex(await $.ajax(this.params))}catch(e){return console.error("Error ao tentar acessar o servidor: ",e),this.setReflex()}}async get(e=""){try{return this.params.data=this.parseStr(this.setReflex(e)),this.params.type="GET",this.params.url=this.setUrl(),this.setReflex(await $.ajax(this.params))}catch(e){return console.error("Error ao tentar acessar o servidor: ",e),this.setReflex()}}async reflect(e=""){return this.setUrl("/authenticate/mirror/reflect"),await this.loadKeys(),this.setReflex(e),this.setPublic(this.keysBox.public),await this.send(),this.setImage(this.reflex.image.public),this.reflex}async distort(e=""){return this.setUrl("/authenticate/mirror/distort"),this.setReflex(e),this.send()}async keep(){return this.setUrl("/authenticate/mirror/keep"),await this.deform(),this.reflex.origin.cipher=this.formBox.deform.origin,this.send()}async reveal(e=""){return this.setUrl("/authenticate/mirror/reveal"),await this.readKeys(),this.reflex.origin.raw=this.setRaw(e),this.send()}async refraction(){this.setUrl("/authenticate/mirror/refraction");var e=await this.send();return this.setReflex(e),this.formBox.deform.image=this.reflex.image.cipher,await this.readKeys(),this.reform(this.formBox.deform.image)}hash(e=""){return sha512(e)}parse(t=""){try{return JSON.parse(t)}catch(e){return t}}parseStr(t=""){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}}